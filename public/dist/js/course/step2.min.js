define(["jquery","template","tool","uploadify","jquery_Jcrop"],function(e,t,i){e(function(){var s,o,a,c,p=i.getParam("cs_id");e.ajax({type:"get",url:"/api/course/picture",data:{cs_id:p},success:function(i){if(console.log(i),200==i.code){var s=t("step2_tpl",i.result);e(".course-add").html(s),e("#upfile").uploadify({swf:"/public/assets/uploadify/uploadify.swf",buttonText:"上传图片",buttonClass:"btn btn-success btn-sm btn_upfile",uploader:"/api/uploader/cover",fileObjName:"cs_cover_original",formData:{cs_id:p},itemTemplate:"<span></span>",fileSizeLimit:"2MB",fileTypeExts:"*.gif; *.jpg; *.png",onUploadSuccess:function(t,i){var s=(i=JSON.parse(i)).result.path;e(".preview img").attr("src",s),e(".brief img").attr("src",s),e("#btn_crop").removeAttr("disabled")}})}}}),e("body").on("click","#btn_crop",function(){"裁切图片"==e(this).text()?(e(this).text("保存图片"),e(".preview img").Jcrop({setSelect:[0,0,1e4,1e4],aspectRatio:2,boxWidth:400},function(){this.initComponent("Thumbnailer",{width:240,height:120,parent:".thumb"});var t=this.getSelection();s=t.x,o=t.y,a=t.w,c=t.h,e(".preview").on("cropmove",function(e,t,i){s=parseInt(i.x),o=parseInt(i.y),a=parseInt(i.w),c=parseInt(i.h)})})):e.ajax({type:"post",url:"/api/course/update/picture",data:{cs_id:p,x:s,y:o,w:a,h:c},success:function(e){200==e.code&&(location.href="/course/step3?cs_id="+p)}})})})});